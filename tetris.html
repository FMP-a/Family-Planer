<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris</title>
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        canvas {
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <button id="startButton">Start Game</button>
    <canvas id="tetrisCanvas" width="300" height="600"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('tetrisCanvas');
            const ctx = canvas.getContext('2d');
            const blockSize = 30;
            const rows = canvas.height / blockSize;
            const cols = canvas.width / blockSize;
            let board = Array.from({ length: rows }, () => Array(cols).fill(0));
            let gameInterval;

            function drawBlock(x, y, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x * blockSize, y * blockSize, blockSize, blockSize);
                ctx.strokeStyle = '#000';
                ctx.strokeRect(x * blockSize, y * blockSize, blockSize, blockSize);
            }

            function drawBoard() {
                for (let row = 0; row < rows; row++) {
                    for (let col = 0; col < cols; col++) {
                        const color = board[row][col];
                        if (color) {
                            drawBlock(col, row, color);
                        }
                    }
                }
            }

            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBoard();
                drawCurrentPiece();
            }

            function drawCurrentPiece() {
                currentPiece.shape.forEach((row, i) => {
                    row.forEach((cell, j) => {
                        if (cell) {
                            drawBlock(currentPiece.x + j, currentPiece.y + i, currentPiece.color);
                        }
                    });
                });
            }

            function collide() {
                for (let row = 0; row < currentPiece.shape.length; row++) {
                    for (let col = 0; col < currentPiece.shape[row].length; col++) {
                        if (
                            currentPiece.shape[row][col] &&
                            (board[currentPiece.y + row] && board[currentPiece.y + row][currentPiece.x + col]) !== 0
                        ) {
                            return true;
                        }
                    }
                }
                return false;
            }

            function mergePiece() {
                for (let row = 0; row < currentPiece.shape.length; row++) {
                    for (let col = 0; col < currentPiece.shape[row].length; col++) {
                        if (currentPiece.shape[row][col]) {
                            board[currentPiece.y + row][currentPiece.x + col] = currentPiece.color;
                        }
                    }
                }
            }

            function rotate() {
                const originalShape = currentPiece.shape;
                currentPiece.shape = currentPiece.shape[0].map((_, i) => currentPiece.shape.map(row => row[i])).reverse();
                if (collide()) {
                    currentPiece.shape = originalShape;
                }
            }

            function moveLeft() {
                currentPiece.x -= 1;
                if (collide()) {
                    currentPiece.x += 1;
                }
            }

            function moveRight() {
                currentPiece.x += 1;
                if (collide()) {
                    currentPiece.x -= 1;
                }
            }

            function moveDown() {
                currentPiece.y += 1;
                if (collide()) {
                    currentPiece.y -= 1;
                    mergePiece();
                    resetPiece();
                    if (collide()) {
                        // Game over
                        alert('Game Over!');
                        stopGame();
                        resetGame();
                    }
                }
            }

            function resetPiece() {
                const pieces = [
                    { shape: [[1, 1, 1, 1]], color: 'cyan' },
                    { shape: [[1, 1, 1], [1]], color: 'blue' },
                    { shape: [[1, 1, 1], [0, 0, 1]], color: 'orange' },
                    { shape: [[1, 1, 1], [1, 0, 0]], color: 'yellow' },
                    { shape: [[1, 1], [1, 1]], color: 'red' },
                    { shape: [[1, 1, 0], [0, 1, 1]], color: 'green' },
                    { shape: [[0, 1, 1], [1, 1]], color: 'purple' },
                ];

                const randomPiece = pieces[Math.floor(Math.random() * pieces.length)];
                currentPiece = {
                    shape: randomPiece.shape,
                    color: randomPiece.color,
                    x: Math.floor(cols / 2) - Math.floor(randomPiece.shape[0].length / 2),
                    y: 0,
                };
            }

            function resetGame() {
                board = Array.from({ length: rows }, () => Array(cols).fill(0));
                draw();
                resetPiece();
            }

            function startGame() {
                if (!gameInterval) {
                    gameInterval = setInterval(() => {
                        moveDown();
                        draw();
                    }, 500); // Adjust the speed by changing the interval
                }
            }

            function stopGame() {
                clearInterval(gameInterval);
                gameInterval = null;
            }

            document.getElementById('startButton').addEventListener('click', () => {
                startGame();
            });

            document.addEventListener('keydown', (event) => {
                if (event.key === 'ArrowUp') {
                    rotate();
                } else if (event.key === 'ArrowLeft') {
                    moveLeft();
                } else if (event.key === 'ArrowRight') {
                    moveRight();
                } else if (event.key === 'ArrowDown') {
                    moveDown();
                }
                draw();
            });

            function update() {
                draw();
                requestAnimationFrame(update);
            }

            update();
        });
    </script>
</body>
</html>
